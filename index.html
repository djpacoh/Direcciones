<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Ordenar Direcciones</h1>

    <div id="excel-container" class="transparency-target">
        <button class="panel-toggle" onclick="togglePanel('excel-container')">−</button>
        <h2>Insertar txt, Cada Dirección en una linea 
            <button id="info-toggle" class="info-button" onclick="showHideInfo()">ℹ️ Más info</button>
        </h2>
        <div id="info-container" style="display: none; background: #e3f2fd; border: 2px solid #2196F3; border-radius: 8px; padding: 15px; margin: 15px 0;">
            <p><strong>📄 Ejemplo de formato correcto:</strong></p>
            <p>Cada dirección debe ir en una línea separada, como se muestra en la imagen:</p>
            <img src="txt.png" alt="Ejemplo de formato txt" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; margin-top: 10px;">
            <p><em>💡 Tip: Puedes usar archivos .txt, .csv, .xlsx o .xls</em></p>
        </div>
        
        <script>
        function showHideInfo() {
            console.log('Botón clickeado!');
            var container = document.getElementById('info-container');
            var button = document.getElementById('info-toggle');
            
            if (container && button) {
                console.log('Elementos encontrados');
                if (container.style.display === 'none') {
                    container.style.display = 'block';
                    button.innerHTML = '❌ Ocultar info';
                    button.style.backgroundColor = '#f44336';
                    console.log('Mostrando info');
                } else {
                    container.style.display = 'none';
                    button.innerHTML = 'ℹ️ Más info';
                    button.style.backgroundColor = '#2196F3';
                    console.log('Ocultando info');
                }
            } else {
                console.error('No se encontraron elementos');
            }
        }
        </script>
        <input type="file" id="excel-file" accept=".xlsx, .xls, .txt, .csv">
        <input type="number" id="zone-count" placeholder="Número de zonas" value=" " min="1" max="500">
        <input type="number" id="max-addresses-per-zone" placeholder="Máximo de direcciones por zona" value=" " min="2" max="5000">
        <input type="number" id="min-addresses-per-zone" placeholder="Mínimo de direcciones por zona" value=" " min="1" max="1000">
        <button id="read-excel">Leer Archivo</button>
        
        <!-- Preview container -->
        <div id="preview-container" style="display: none;">
            <h3>Direcciones encontradas en el archivo:</h3>
            <div id="preview-info">
                <span id="total-addresses">0</span> direcciones detectadas
            </div>
            <div id="address-preview" style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                <!-- Las direcciones aparecerán aquí -->
            </div>
            <div style="margin-top: 10px;">
                <button id="process-excel" style="background-color: #4CAF50;">Procesar y Agrupar</button>
                <button id="cancel-process" style="background-color: #f44336; margin-left: 10px;">Cancelar</button>
            </div>
        </div>
        
        <!-- Progress container -->
        <div id="progress-container" style="display: none;">
            <div id="progress-text">Procesando...</div>
            <div id="progress-bar">
                <div id="progress-fill"></div>
            </div>
            <div id="progress-percentage">0%</div>
        </div>
    </div>

    <div id="manual-container" class="transparency-target">
        <button class="panel-toggle" onclick="togglePanel('manual-container')">−</button>
        <h2>Gestión Manual de Direcciones ( Añadir a Mapa)</h2>
        
        <!-- Sección para agregar a zonas existentes -->
        <div id="add-to-zone-section" style="display: none;">
            <h3>➕ Agregar Dirección a Zona Existente</h3>
            <div class="add-to-zone-controls">
                <select id="zone-selector" class="zone-select">
                    <option value="">Seleccionar zona...</option>
                </select>
                <div class="address-input-wrapper">
                    <input type="text" id="new-zone-address" placeholder="Dirección a agregar">
                    <button class="mic-button" data-target="new-zone-address">🎤</button>
                </div>
                <button id="add-to-zone-btn" class="action-button add-button">➕ Agregar a Zona</button>
            </div>
        </div>
        
        <hr style="margin: 20px 0;">
        
        <!-- Sección original para crear ruta optimizada -->
        <h3>🛣️ Crear Ruta Optimizada Manual (Función Independiente)</h3>
        <div class="address-input-wrapper">
            <input type="text" id="base-address" placeholder="Dirección base">
            <button class="mic-button" data-target="base-address">🎤</button>
        </div>
        <div id="address-list-container">
            <div class="address-input-wrapper">
                <input type="text" class="address-input" placeholder="Añadir dirección">
                <button class="mic-button" data-target-class="address-input">🎤</button>
            </div>
        </div>
        <button id="add-address">Añadir otra dirección</button>
        <button id="sort-addresses">Ordenar</button>
    </div>

    <!-- Controles de selección múltiple -->
    <div id="multi-select-controls" style="display: none;">
        <div class="multi-select-header">
            <div class="multi-select-title">
                <h3>🎯 Selección Múltiple</h3>
                <button id="minimize-multi-select" class="minimize-btn" title="Minimizar panel">➖</button>
            </div>
            <div class="multi-select-info">
                <span id="selected-count">0</span> seleccionadas
            </div>
        </div>
        <div id="multi-select-actions" class="multi-select-actions">
            <button id="create-new-zone-btn" class="multi-select-btn create-zone-btn" disabled>
                ➕ Nueva Zona
            </button>
            <button id="move-to-zone-btn" class="multi-select-btn move-zone-btn" disabled>
                🔄 Mover a Zona
            </button>
            <button id="clear-selection-btn" class="multi-select-btn clear-btn">
                🚫 Limpiar
            </button>
            <button id="exit-multi-select-btn" class="multi-select-btn exit-btn">
                ❌ Salir
            </button>
        </div>
    </div>

    <!-- Controles del mapa -->
    <div id="map-controls">
        <button id="toggle-multi-select-btn" class="map-control-btn">
            🎯 Activar Selección Múltiple
        </button>
        <button id="fit-all-zones-btn" class="map-control-btn">
            🔍 Ver Todas las Zonas
        </button>
        <div class="zone-view-controls" id="zone-view-controls" style="display: none;">
            <select id="zone-view-selector" class="zone-view-select">
                <option value="">Seleccionar zona...</option>
            </select>
            <button id="view-zone-btn" class="map-control-btn view-zone-btn" disabled>
                📍 Ver Zona
            </button>
        </div>
        <button id="toggle-map-click-btn" class="map-control-btn map-click-btn">
            ➕ Modo Agregar Puntos
        </button>
        <button id="toggle-map" class="map-control-btn">Minimizar/Maximizar Mapa</button>
    </div>
    
    <!-- Gestión de sesiones -->
    <div id="session-controls" style="display: none;">
        <div class="session-header">
            <h3>💾 Gestión de Sesiones</h3>
            <div class="session-actions">
                <button id="save-session-btn" class="session-btn save-btn">
                    💾 Guardar Sesión
                </button>
                <button id="load-session-btn" class="session-btn load-btn">
                    📂 Cargar Sesión
                </button>
                <button id="manage-sessions-btn" class="session-btn manage-btn">
                    ⚙️ Administrar
                </button>
            </div>
        </div>
    </div>

    <div id="map"></div>
    
    <!-- Controlador de Transparencia -->
    <div id="transparency-controller">
        <span id="transparency-label">🎭 Transparencia</span>
        <input type="range" id="transparency-slider" min="0" max="100" value="90" step="5">
        <span id="transparency-value">90%</span>
    </div>
    
    <div id="output-container" class="transparency-target">
        <button class="panel-toggle" onclick="togglePanel('output-container')">−</button>
        <h2>Resultados</h2>
        <ul id="sorted-addresses"></ul>
    </div>

    <!-- Panel de edición de zona -->
    <div id="zone-editor-overlay" style="display: none;">
        <div id="zone-editor-modal">
            <div class="zone-editor-header">
                <h3 id="zone-editor-title">Editar Zona</h3>
                <button id="zone-editor-close" class="close-button">×</button>
            </div>
            <div class="zone-editor-content">
                <div class="zone-editor-info">
                    <div id="zone-editor-stats"></div>
                </div>
                <div class="zone-editor-addresses">
                    <h4>Direcciones en esta zona:</h4>
                    <div id="zone-editor-list"></div>
                </div>
                <div class="zone-editor-actions">
                    <div class="primary-actions">
                        <button id="zone-editor-save" class="save-button">💾 Guardar Cambios</button>
                        <button id="zone-editor-cancel" class="cancel-button">❌ Cancelar</button>
                    </div>
                    <div class="zone-danger-actions">
                        <button id="zone-editor-delete" class="delete-zone-button">🗑️ Eliminar Zona Completa</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para guardar sesión -->
    <div id="save-session-modal" class="session-modal-overlay" style="display: none;">
        <div class="session-modal">
            <div class="session-modal-header">
                <h3>💾 Guardar Sesión Actual</h3>
                <button class="session-modal-close">&times;</button>
            </div>
            <div class="session-modal-content">
                <div class="session-info">
                    <div class="session-stats">
                        <p><strong>🗂️ Zonas actuales:</strong> <span id="current-zones-count">0</span></p>
                        <p><strong>📍 Total direcciones:</strong> <span id="current-addresses-count">0</span></p>
                        <p><strong>📅 Fecha:</strong> <span id="current-date"></span></p>
                    </div>
                </div>
                <div class="input-group">
                    <label for="session-name">Nombre de la sesión:</label>
                    <input type="text" id="session-name" placeholder="Ej: Reparto Lunes Barcelona" maxlength="50">
                </div>
                <div class="session-modal-actions">
                    <button id="confirm-save-session" class="session-action-btn save-action">💾 Guardar</button>
                    <button id="cancel-save-session" class="session-action-btn cancel-action">❌ Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para cargar sesión -->
    <div id="load-session-modal" class="session-modal-overlay" style="display: none;">
        <div class="session-modal">
            <div class="session-modal-header">
                <h3>📂 Cargar Sesión Guardada</h3>
                <button class="session-modal-close">&times;</button>
            </div>
            <div class="session-modal-content">
                <div class="sessions-list" id="sessions-list">
                    <p class="no-sessions">No hay sesiones guardadas</p>
                </div>
                <div class="session-modal-actions">
                    <button id="cancel-load-session" class="session-action-btn cancel-action">❌ Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para administrar sesiones -->
    <div id="manage-sessions-modal" class="session-modal-overlay" style="display: none;">
        <div class="session-modal">
            <div class="session-modal-header">
                <h3>⚙️ Administrar Sesiones</h3>
                <button class="session-modal-close">&times;</button>
            </div>
            <div class="session-modal-content">
                <div class="manage-info">
                    <p>📊 <strong>Total sesiones:</strong> <span id="total-sessions-count">0</span></p>
                    <p>💾 <strong>Almacenamiento usado:</strong> <span id="storage-used">0 KB</span></p>
                </div>
                <div class="sessions-manage-list" id="sessions-manage-list">
                    <p class="no-sessions">No hay sesiones para administrar</p>
                </div>
                <div class="session-modal-actions">
                    <button id="clear-all-sessions" class="session-action-btn danger-action">🗑️ Eliminar Todas</button>
                    <button id="cancel-manage-sessions" class="session-action-btn cancel-action">❌ Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="xlsx.full.min.js"></script>
    <script src="script.js"></script>

</body>
</html>